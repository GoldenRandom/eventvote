# Cloudflare Pages Deployment Guide

## Quick Deploy Steps

1. **Push to GitHub/GitLab**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin <your-repo-url>
   git push -u origin main
   ```

2. **Connect to Cloudflare Pages**
   - Go to [Cloudflare Dashboard](https://dash.cloudflare.com) → Pages
   - Click "Create a project"
   - Connect your Git repository
   - Select the repository and branch

3. **Configure Build Settings**
   - **Build command**: (leave empty)
   - **Build output directory**: `public`
   - **Root directory**: `/` (root)

4. **Configure D1 Database Binding** (IMPORTANT!)
   - Go to Settings → Functions → D1 database bindings
   - Click "Add binding"
   - **Variable name**: `DB` (must match exactly)
   - **D1 database**: Select `voting-db`
   - Save

5. **Environment Variables** (if needed)
   - Go to Settings → Environment variables
   - Add any additional variables if required

6. **Deploy!**
   - Click "Save and Deploy"
   - Your site will be live at `https://your-project.pages.dev`

## Project Structure for Pages

```
VOTE/
├── functions/          # Serverless Functions (API routes)
│   ├── api/
│   │   └── [[path]].js  # Handles /api/* routes
│   └── _middleware.js   # CORS and middleware
├── public/             # Static files (HTML, CSS, JS)
│   ├── index.html
│   ├── app.js
│   ├── styles.css
│   └── _redirects      # SPA routing
├── src/                # Shared code
│   └── api-handler.js  # API logic
├── migrations/         # Database migrations
└── package.json
```

## API Routes

All API routes are handled by `functions/api/[[path]].js`:
- `POST /api/events` - Create event
- `GET /api/events/:id` - Get event
- `GET /api/events/qr/:qrCode` - Get event by QR code
- `PUT /api/events/:id/status` - Update event status
- `POST /api/images` - Upload image
- `POST /api/votes` - Submit vote
- `GET /api/images/:id/votes` - Get votes for image

## Troubleshooting

**Issue**: Database binding not found
- Make sure D1 binding is configured in Pages settings
- Binding name must be exactly `DB` (case-sensitive)
- Verify database exists in Cloudflare Dashboard → D1

**Issue**: Functions not working
- Check Functions tab in Pages dashboard for errors
- Verify import paths are correct
- Check that `functions/` directory structure is correct

**Issue**: CORS errors
- Middleware should handle this automatically
- Check browser console for specific errors

## Local Development

For local development with Pages:

```bash
# Install Wrangler Pages plugin
npm install -D wrangler

# Run local Pages dev server
npx wrangler pages dev public --d1=DB=voting-db
```

Or use the existing dev command:
```bash
npm run dev
```

